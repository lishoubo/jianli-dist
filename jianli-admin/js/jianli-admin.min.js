/*!  2016-08-06 */
var jlApp=angular.module("jlApp",["ngRoute"]);jlApp.constant("config",{host:"",assetsRoot:"/jianli-admin"}),jlApp.config(["$httpProvider",function(a){a.defaults.withCredentials=!0}]),jlApp.filter("range",function(){return function(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}}),jlApp.config(["$routeProvider","config",function(a,b){a.when("/",{templateUrl:b.assetsRoot+"/pages/staff/staff.html",controller:"staffController"}).when("/building",{templateUrl:b.assetsRoot+"/pages/building/building.html",controller:"buildingController"}).when("/journal",{templateUrl:b.assetsRoot+"/pages/journal/journal.html",controller:"journalController"}).when("/journal/form",{templateUrl:b.assetsRoot+"/pages/journal/form.html",controller:"journalController"}).when("/journal/form/:id",{templateUrl:b.assetsRoot+"/pages/journal/form.html",controller:"journalController"}).when("/apply",{templateUrl:b.assetsRoot+"/pages/apply/list.html",controller:"applyController"})}]),jlApp.controller("staffController",["$scope","$http","config",function(a,b,c){a.result={data:{page:0,pageSize:10,items:[]}},a.form={},a.go_to_page=function(d){d||(d=1),b.get(c.host+"/api/admin/staffs",{params:{page:d,pageSize:10}}).success(function(b){console.log(b),b.success?a.result.data=b.data:bootbox.alert({title:"查询失败",message:b.message})}).error(function(a){bootbox.alert({title:"查询失败",message:a})})},a.add_staff=function(){b.post(c.host+"/api/admin/staffs",a.form).success(function(b){b.success?($(".modal").modal("hide"),a.go_to_page(1)):bootbox.alert({title:"添加失败",message:b.message,closable:!0})}).error(function(a){console.log(a)})},a.delete_staff=function(d){bootbox.confirm("确定删除吗?",function(e){e&&b.post(c.host+"/api/admin/staffs/delete?id="+d).success(function(b){b.success?a.go_to_page(1):bootbox.alert({title:"删除失败",message:b.message,closable:!0})}).error(function(a){bootbox.alert({title:"删除失败",message:a,closable:!0})})})},a.update_staff=function(){b.post(c.host+"/api/admin/staffs/update",a.form).success(function(b){b.success?($("#update-staff-modal").modal("hide"),a.go_to_page(1)):bootbox.alert({title:"更新失败",message:b.message,closable:!0})}).error(function(a){bootbox.alert({title:"更新失败",message:a,closable:!0})})},a.open_add_form=function(){a.form={},$("#add-staff-modal").modal("show")},a.open_update_form=function(d){b.get(c.host+"/api/admin/staffs/queryById?id="+d).success(function(b){b.success?(a.form=b.data,$("#update-staff-modal").modal("show")):bootbox.alert({title:"查询失败",message:b.message})}).error(function(a){bootbox.alert({title:"查询失败",message:a})})},a.go_to_page(1)}]),jlApp.controller("buildingController",["$scope","$http","config",function(a,b,c){a.result={data:{page:0,pageSize:10,items:[]}},a.form={address:{distinct:"西湖区"}},a.go_to_page=function(d){d||(d=1),b.get(c.host+"/api/admin/building",{params:{page:d,pageSize:10}}).success(function(b){a.result.data=b.data}).error(function(a){console.log(a)})},a.open_update_building=function(d){b.get(c.host+"/api/admin/building/queryById?id="+d).success(function(b){b.success?(a.form=b.data,$("#update-building-modal").modal("show")):bootbox.alert({title:"查询失败",message:b.message})}).error(function(a){bootbox.alert({title:"查询失败",message:a})})},a.open_add_building=function(){a.form={address:{district:"西湖区"}},$("#add-building-modal").modal("show")},a.add_building=function(){b.post(c.host+"/api/admin/building",a.form).success(function(b){b.success?($("#add-building-modal").modal("hide"),a.go_to_page(1)):bootbox.alert({title:"添加失败",message:b.message,closable:!0})}).error(function(a){console.log(a)})},a.update_building=function(){b.post(c.host+"/api/admin/building/update",a.form).success(function(b){b.success?($("#update-building-modal").modal("hide"),a.go_to_page(1)):bootbox.alert({title:"更新失败",message:b.message})}).error(function(a){bootbox.alert({title:"更新失败",message:a})})},a.delete_building=function(d){bootbox.confirm("确定删除吗?",function(e){e&&b.post(c.host+"/api/admin/building/delete?id="+d).success(function(b){b.success?a.go_to_page(1):bootbox.alert({title:"删除失败",message:b.message,closable:!0})}).error(function(a){bootbox.alert({title:"删除失败",message:a,closable:!0})})})},a.go_to_page(1)}]),jlApp.controller("baikeController",["$scope","$http","$location","$routeParams","config",function(a,b,c,d,e){a.form={procedure:"PREPARE"},a.result={data:{page:0,pageSize:10,items:[]}},a.get_baike=function(c){b.get(e.host+"/api/admin/baike/queryById?id="+c).success(function(b){if(b.success){a.form=b.data;var c=document.createElement("div");c.innerHTML=a.form.content,$("#baike-editor").summernote("insertNode",c)}else bootbox.alert({title:"查询失败",message:b.message})}).error(function(a){bootbox.alert({title:"查询失败",message:a})})},a.add_baike=function(){var d=$("#baike-editor").summernote("code");a.form.content=d,b.post(e.host+"/api/admin/baike",a.form).success(function(a){a.success?c.path("/baike"):bootbox.alert({title:"添加失败",message:a.message})}).error(function(a){bootbox.alert({title:"添加失败",message:a})})},a.update_baike=function(){var d=$("#baike-editor").summernote("code");a.form.content=d,console.log(a.form),b.post(e.host+"/api/admin/baike/update",a.form).success(function(a){a.success?c.path("/baike"):bootbox.alert({title:"更新失败",message:a.message})}).error(function(a){bootbox.alert({title:"更新失败",message:a})})},a.delete_baike=function(c){bootbox.confirm("确定删除吗?",function(d){d&&b.post(e.host+"/api/admin/baike/delete?id="+c).success(function(b){b.success?a.go_to_page(1):bootbox.alert({title:"删除失败",message:b.message,closable:!0})}).error(function(a){bootbox.alert({title:"删除失败",message:a,closable:!0})})})},a.show_content=function(a){b.get(e.host+"/api/admin/baike/queryById?id="+a).success(function(a){a.success?(console.log(a),bootbox.dialog({title:"百科内容",message:a.data.content,show:!0})):bootbox.alert({title:"查询失败",message:a.message})}).error(function(a){bootbox.alert({title:"查询失败",message:a})})},a.go_to_page=function(c){c||(c=1),b.get(e.host+"/api/admin/baike",{params:{page:c,pageSize:10}}).success(function(b){a.result.data=b.data}).error(function(a){console.log(a)})},a.go_to_page(1),d.id&&a.get_baike(d.id)}]),jlApp.controller("journalController",["$scope","$http","$route","$location","$routeParams","config",function(a,b,c,d,e,f){a.buildings=[],a.form={procedure:"PREPARE"},a.result={data:{page:0,pageSize:10,items:[]}},a.get_buildings=function(){b.get(f.host+"/api/admin/building",{params:{page:1,pageSize:100}}).success(function(b){a.buildings=b.data.items,console.log(a.buildings)}).error(function(a){console.log(a)})},a.get_journal=function(c){b.get(f.host+"/api/admin/journal/queryById?id="+c).success(function(b){if(b.success){console.log(b),a.form={staff:b.data.staff.name,building:b.data.building.name,cover:b.data.cover,procedure:b.data.procedure,content:b.data.content};var c=document.createElement("div");c.innerHTML=a.form.content,$("#journal-editor").summernote("insertNode",c)}else bootbox.alert({title:"查询失败",message:b.message})}).error(function(a){bootbox.alert({title:"查询失败",message:a})})},a.add_journal=function(){var c=$("#journal-editor").summernote("code");a.form.content=c,b.post(f.host+"/api/admin/journal",a.form).success(function(a){a.success?d.path("/journal"):bootbox.alert({title:"添加失败",message:a.message})}).error(function(a){bootbox.alert({title:"添加失败",message:a})})},a.update_journal=function(){var c=$("#journal-editor").summernote("code");a.form.content=c,console.log(a.form),b.post(f.host+"/api/admin/journal/update",a.form).success(function(a){a.success?d.path("/journal"):bootbox.alert({title:"更新失败",message:a.message})}).error(function(a){bootbox.alert({title:"更新失败",message:a})})},a.delete_journal=function(c){bootbox.confirm("确定删除吗?",function(d){d&&b.post(f.host+"/api/admin/journal/delete?id="+c).success(function(b){b.success?a.go_to_page(1):bootbox.alert({title:"删除失败",message:b.message,closable:!0})}).error(function(a){bootbox.alert({title:"删除失败",message:a,closable:!0})})})},a.show_content=function(a){b.get(f.host+"/api/admin/journal/queryById?id="+a).success(function(a){a.success?(console.log(a),bootbox.dialog({title:"监理日志内容",message:a.data.content,show:!0})):bootbox.alert({title:"查询失败",message:a.message})}).error(function(a){bootbox.alert({title:"查询失败",message:a})})},a.go_to_page=function(c){c||(c=1),b.get(f.host+"/api/admin/journal",{params:{page:c,pageSize:10}}).success(function(b){a.result.data=b.data}).error(function(a){console.log(a)})},a.go_to_page(1),e.id&&a.get_journal(e.id),-1!=c.current.$$route.originalPath.indexOf("form")&&a.get_buildings()}]),jlApp.controller("applyController",["$scope","$http","config",function(a,b,c){a.result={data:{page:0,pageSize:10,items:[]}},a.go_to_page=function(d){d||(d=1),b.get(c.host+"/api/server/charge",{params:{page:d,pageSize:10}}).success(function(b){a.result.data=b.data}).error(function(a){console.log(a)})},a.go_to_page(1)}]);